(()=>{"use strict";var e,t,n=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function c(e){try{a(r.next(e))}catch(e){s(e)}}function i(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}a((r=r.apply(e,t||[])).next())}))},r=function(e,t){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},o=function(){function e(){}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getLocalStorage=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,chrome.storage.local.get(e)];case 1:return[2,n.sent()];case 2:throw t=n.sent(),console.error("ðŸ›œðŸ›‘ Failed to get value from storage",t),t;case 3:return[2]}}))}))},e.prototype.setLocalStorage=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,chrome.storage.local.set(e)];case 1:return n.sent(),[3,3];case 2:throw t=n.sent(),console.error("ðŸ›œðŸ›‘ Failed to set value in storage",t),t;case 3:return[2]}}))}))},e.prototype.removeLocalStorage=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,chrome.storage.local.remove(e)];case 1:return n.sent(),[3,3];case 2:throw t=n.sent(),console.error("ðŸ›œðŸ›‘ Failed to remove value from storage",t),t;case 3:return[2]}}))}))},e.prototype.clearLocalStorage=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,chrome.storage.local.clear()];case 1:return t.sent(),[3,3];case 2:throw e=t.sent(),console.error("ðŸ›œðŸ›‘ Failed to clear local storage",e),e;case 3:return[2]}}))}))},e.prototype.getCurrentTab=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,chrome.tabs.query({active:!0,currentWindow:!0})];case 1:return[2,t.sent()[0]||null];case 2:throw e=t.sent(),console.error("ðŸ›œðŸ›‘ Failed to get current tab",e),e;case 3:return[2]}}))}))},e.prototype.createTab=function(e){return n(this,void 0,void 0,(function(){var t,n,o,s;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=navigator.userAgent.toLowerCase(),n="chrome://extensions",t.includes("brave")?n="brave://extensions":t.includes("edg")?n="edge://extensions":t.includes("opera")?n="opera://extensions":t.includes("vivaldi")&&(n="vivaldi://extensions"),o="".concat(n,"/?id=").concat(e),[4,chrome.tabs.create({url:o,active:!0})];case 1:return[2,r.sent()];case 2:throw s=r.sent(),console.error("ðŸ›œðŸ›‘ Failed to create tab",s),s;case 3:return[2]}}))}))},e.prototype.sendMessage=function(e,t){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,chrome.tabs.sendMessage(e,t)];case 1:return[2,r.sent()];case 2:throw n=r.sent(),console.error("ðŸ›œðŸ›‘ Failed to send message to tab",n),n;case 3:return[2]}}))}))},e.prototype.sendRuntimeMessage=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,chrome.runtime.sendMessage(e)];case 1:return[2,n.sent()];case 2:throw t=n.sent(),console.error("ðŸ›œðŸ›‘ Failed to send runtime message",t),t;case 3:return[2]}}))}))},e.prototype.addMessageListener=function(e){chrome.runtime.onMessage.addListener(e)},e.prototype.setIcon=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,chrome.action.setIcon(e)];case 1:return n.sent(),[3,3];case 2:throw t=n.sent(),console.error("ðŸ›œðŸ›‘ Failed to set icon",t),t;case 3:return[2]}}))}))},e.prototype.getAllExtensions=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,new Promise((function(e){chrome.management.getAll(e)}))];case 1:return[2,t.sent()];case 2:throw e=t.sent(),console.error("ðŸ›œðŸ›‘ Failed to get all extensions",e),e;case 3:return[2]}}))}))},e.prototype.getExtensionInfo=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,new Promise((function(t,n){chrome.management.get(e,(function(e){chrome.runtime.lastError?n(chrome.runtime.lastError):t(e)}))}))];case 1:return[2,n.sent()];case 2:throw t=n.sent(),console.error("ðŸ›œðŸ›‘ Failed to get extension info",t),t;case 3:return[2]}}))}))},e.prototype.toggleExtension=function(e,t){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,new Promise((function(n,r){chrome.management.setEnabled(e,t,(function(){chrome.runtime.lastError?r(chrome.runtime.lastError):n()}))}))];case 1:return r.sent(),[3,3];case 2:throw n=r.sent(),console.error("ðŸ›œðŸ›‘ Failed to toggle extension",n),n;case 3:return[2]}}))}))},e.prototype.uninstallExtension=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,new Promise((function(t,n){chrome.management.uninstall(e,(function(){chrome.runtime.lastError?n(chrome.runtime.lastError):t()}))}))];case 1:return n.sent(),[3,3];case 2:throw t=n.sent(),console.error("ðŸ›œðŸ›‘ Failed to uninstall extension",t),t;case 3:return[2]}}))}))},e.prototype.hasOffscreenDocument=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,chrome.offscreen.hasDocument()];case 1:return[2,t.sent()];case 2:throw e=t.sent(),console.error("ðŸ›œðŸ›‘ Failed to check offscreen document",e),e;case 3:return[2]}}))}))},e.prototype.createOffscreenDocument=function(e,t,o){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,chrome.offscreen.createDocument({url:e,reasons:t,justification:o})];case 1:return r.sent(),[3,3];case 2:throw n=r.sent(),console.error("ðŸ›œðŸ›‘ Failed to create offscreen document",n),n;case 3:return[2]}}))}))},e.prototype.closeOffscreenDocument=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,chrome.offscreen.closeDocument()];case 1:return t.sent(),[3,3];case 2:throw e=t.sent(),console.error("ðŸ›œðŸ›‘ Failed to close offscreen document",e),e;case 3:return[2]}}))}))},e}().getInstance(),s=(e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});t=Error,s((function(e,n,r){var o=t.call(this,e)||this;return o.code=n,o.details=r,o.name="AppError",o}),t),function(){function e(){this.logs=[],this.MAX_LOGS=1e3}e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getCallerInfo=function(){var e=(new Error).stack;if(e){var t=e.split("\n")[3];if(t){var n=t.match(/chrome-extension:\/\/[^/]+\/([^:]+):(\d+):(\d+)/);if(n)return{file:n[1],line:parseInt(n[2],10),column:parseInt(n[3],10)}}}},e.prototype.formatMessage=function(e,t,n){void 0===t&&(t={});var r=(new Date).toISOString(),o=t.group?"[".concat(t.group,"]"):"",s=n?"(".concat(n.file,":").concat(n.line,":").concat(n.column,")"):"";return"".concat(r," ").concat(o," ").concat(s," ").concat(e)},e.prototype.storeLog=function(e,t,n){if(void 0===n&&(n={}),n.persist){var r=this.getCallerInfo();this.logs.push({message:e,level:t,timestamp:Date.now(),group:n.group,caller:r}),this.logs.length>this.MAX_LOGS&&this.logs.shift()}},e.prototype.debug=function(e,t){void 0===t&&(t={});var n=this.getCallerInfo(),r=this.formatMessage(e,t,n);console.debug(r),this.storeLog(e,"debug",t)},e.prototype.info=function(e,t){void 0===t&&(t={});var n=this.getCallerInfo(),r=this.formatMessage(e,t,n);console.info(r),this.storeLog(e,"info",t)},e.prototype.warn=function(e,t){void 0===t&&(t={});var n=this.getCallerInfo(),r=this.formatMessage(e,t,n);console.warn(r),this.storeLog(e,"warn",t)},e.prototype.error=function(e,t){void 0===t&&(t={});var n=this.getCallerInfo(),r=this.formatMessage(e,t,n);console.error(r),this.storeLog(e,"error",t)},e.prototype.getLogs=function(){return this.logs},e.prototype.clearLogs=function(){this.logs=[]}}();var c=function(){},i=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function c(e){try{a(r.next(e))}catch(e){s(e)}}function i(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}a((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},u=function(){return i(void 0,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return c("ðŸ”™ðŸŒ± Initializing background script",{group:"Background",persist:!0}),e=function(e,t,n){return"OFFSCREEN_LOG"===e.type?(c("ðŸ–¥ðŸ–¥ðŸ–¥ ".concat(e.message),{group:"Offscreen",persist:!0}),n({success:!0}),!0):("COLOR_SCHEME_CHANGED"===e.type&&(c("ðŸ”™ðŸ«± Color scheme changed",{group:"Background",persist:!0}),u=e.isDarkMode,r=void 0,s=void 0,a=function(){var e,t;return function(e,t){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,(function(n){switch(n.label){case 0:c("ðŸ§°ðŸŽ¨ Updating extension icon",{group:"background",persist:!0}),n.label=1;case 1:return n.trys.push([1,3,,4]),e=u?"/icons/dark/":"/icons/light/",[4,o.setIcon({path:{16:"".concat(e,"icon16.png"),48:"".concat(e,"icon48.png"),128:"".concat(e,"icon128.png")}})];case 2:return n.sent(),c("ðŸ§°ðŸŽ¨ Icon updated",{group:"background",persist:!0}),[3,4];case 3:return t=n.sent(),console.error("ðŸ§°ðŸ›‘ Failed to update extension icon",t),[3,4];case 4:return[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,o)}c((a=a.apply(r,s||[])).next())})),n({success:!0})),!0);var r,s,i,a,u},chrome.runtime.onMessage.removeListener(e),chrome.runtime.onMessage.addListener(e),[4,i(void 0,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),[4,o.hasOffscreenDocument()];case 1:return t.sent()?[4,o.closeOffscreenDocument()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[4,o.createOffscreenDocument("offscreen.html",["MATCH_MEDIA"],"Detect system color scheme changes")];case 4:return t.sent(),c("ðŸ”™ðŸŒ± Offscreen document created successfully",{group:"Background",persist:!0}),[3,6];case 5:return e=t.sent(),console.error("ðŸ”™ðŸ›‘ Failed to initialize extensions",e),[3,6];case 6:return[2]}}))}))];case 1:return t.sent(),[2]}}))}))};chrome.runtime.onInstalled.addListener((function(e){return i(void 0,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return c("ðŸ”™ðŸ«± Extension installed",{group:"Background",persist:!0}),[4,u()];case 1:return e.sent(),[2]}}))}))})),chrome.runtime.onStartup.addListener((function(){return i(void 0,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return c("ðŸ”™ðŸ«± Extension started",{group:"Background",persist:!0}),[4,u()];case 1:return e.sent(),[2]}}))}))}))})();